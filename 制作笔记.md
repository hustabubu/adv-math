## 制作笔记

[toc]

### 1.制作放大镜

为了尽量高内聚，将放大镜的代码**封装成一个函数**，方便使用。详情看文件
`src\utils\useMagnifierDom.ts`（已经完成）

三种具体编写方案：
1. **原生操作 DOM 方案**
   - **面向过程**式编写（目前采用）；
   - **面向对象**式编写，也就是封装成**类**，方便使用；
2. 通过 Vue 的**自定义组件** `defineComponent()` 来编写；
3. 通过 Vue 的**自定义元素** `defineCustomElement()` 来编写成 web component.

#### 1.1.技术路线

**路线 1： 用 CSS 来制作。**
小、大两张图片，分别是原始、放大。小图背景，大图于放大镜内。
优点：简单、直观。
缺点：不够精细，可扩展性差。

**路线 2：用 canvas 来制作。**
用 canvas 的`clip()` 来需要截取放大镜内的图片内容，再画出来。
优点：精细，可扩展性好。
缺点：需要理解 canvas 的 API，编写代码复杂。

**路线 3：用 SVG 来制作。**
优点：由于是矢量图，放大不变形。
缺点：比 canvas 占一定的资源。

我的需求：需要一定的精度、需要可扩展性、放大的效果好。
故**选择用 Canvas 来制作**。

----

#### 1.2.技术难点

**难点 1：** 获取当前页面的图片数据，即要**截图**（无论是路线 1，还是路线 2，都需要截图）。
**实现工具：**
1. html2canvas 库：把 dom 转成 canvas。但库老旧，已经不维护，且效果不理想。
2. modern-screenshoot 库：把 dom 转化为图片，比 html2canvas 好用，但截图也不尽如人意（与页面的原始图有一定的偏差【在**可接受**范围】，但对 grid 布局（或可能是 unocss）不友好，偏差较大【可能是对绝对定位元素有影响，**难以接受**】）。
3. 用原生的 `getDisplayMedia()` 来截图。效果很好！缺点很讨厌，**需要用户授权，没法无感使用**【**难以接受**】。

综上所述，选择 modern-screenshoot 库，减少unocss.

**难点 2：** 

### 2.全局图层的自定义
基础信息看 Slidev 官网的[全局图层](https://cn.sli.dev/features/global-layers)

#### 2.1.自定义导航栏

在文件 `custom-nav-controls.vue` 中添加的组件，都会在原来导航栏的基础上，往后插入，即插入插槽`<CustomNavControls />`。

目前添加了两个组件：
1. 放大镜组件；
2. 返回目录页。

**细节：**
1. 为了与原来导航栏的风格一致，可以**参考原来内置的组件** `\node_modules\@slidev\client\internals\NavControls.vue` 来制作。
2. ==**Slidev 中的已有的组件的使用**==（包括没有直接暴露出来的）
   - 官方文档没有提及（没有直接暴露出来的），但 Slidev 有的组件，可以类似的通过如下方式导入：
        >`import VerticalDivider from '@slidev/client/internals/VerticalDivider.vue'`
   - 如果官方文档提及有的，
        >在写在幻灯片的 markdown 文件，则直接使用；
        >在自己写的 Vue 文件中，则可以通过 `import *** from '@slidev/client/***.vue'` 来导入。
3. **导航栏的按钮**：
   - **按钮**： `<IconButton>`，其样式通常用 `slidev-icon-btn`
   - 按钮的**扩展菜单**：`<MenuButton>`
   - 垂直分割线：`<VerticalDivider>`
4. **图标使用：** 风格是 Carbon 图标（[Iconify 图标库](https://icon-sets.iconify.design/carbon/?keyword=carbon)），例如
   ```html
    <VerticalDivider />
    <button class="slidev-icon-btn" title="toc" @click="go(2)">
        <carbon:table-of-contents />
    </button>
   ```

### 3.在 Slidev 按钮图标的使用
为了保证风格的一致性，建议采取以下方式来用：
1. 按钮内插入图标
   ```html
    <button class="slidev-icon-btn" title="magnifier" @click="toggleMagnifier">
     <carbon:zoom-in />
    </button>
   ```
2. 使用使用 Slidev 的按钮 `<IconButton>`（虽然未暴露）
   ```html
   <IconButton :class="..." title="..." @click="doSomething">
        <div class="i-carbon:arrow-left" />
   </IconButton>
   ```


